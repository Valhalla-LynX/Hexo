<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>[DesignPattern][Eng] Pipeline Design Pattern | Observatory</title><meta name="keywords" content="设计模式,解耦,Java"><meta name="author" content="V-LynX"><meta name="copyright" content="V-LynX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="AbstractDoc: What’s pipeline. [English] | [中文] The pipeline pattern is one of the common variants of the Chain of Responsibility pattern. In the chain of responsibility mode, there is only one process">
<meta property="og:type" content="article">
<meta property="og:title" content="[DesignPattern][Eng] Pipeline Design Pattern">
<meta property="og:url" content="http://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline/index.html">
<meta property="og:site_name" content="Observatory">
<meta property="og:description" content="AbstractDoc: What’s pipeline. [English] | [中文] The pipeline pattern is one of the common variants of the Chain of Responsibility pattern. In the chain of responsibility mode, there is only one process">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2022-03-21T03:52:25.000Z">
<meta property="article:modified_time" content="2023-09-19T08:04:24.721Z">
<meta property="article:author" content="V-LynX">
<meta property="article:tag" content="设计模式">
<meta property="article:tag" content="解耦">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?28754adf25091073afae7978c85a0022";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[DesignPattern][Eng] Pipeline Design Pattern',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-19 16:04:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="http://pic.valhalla.space/img/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Observatory</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">[DesignPattern][Eng] Pipeline Design Pattern</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-21T03:52:25.000Z" title="发表于 2022-03-21 11:52:25">2022-03-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-19T08:04:24.721Z" title="更新于 2023-09-19 16:04:24">2023-09-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="[DesignPattern][Eng] Pipeline Design Pattern"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>Doc: What’s pipeline. [<a href="https://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline/" title="Spark">English</a>] | [<a href="https://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline_CN/" title="Spark_CN">中文</a>]</p>
<p>The pipeline pattern is one of the common variants of the Chain of Responsibility pattern. In the chain of responsibility mode, there is only one processor on the chain to process data, while in the pipeline mode, multiple processors will process the data.</p>
<p>From Wikipedia:</p>
<blockquote>
<p>In software engineering, a pipeline consists of a chain of processing elements (processes, threads, coroutines, functions, etc.), arranged so that the output of each element is the input of the next; the name is by analogy to a physical pipeline.</p>
</blockquote>
<h1 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h1><h2 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h2><p>The input information is processed for use in the next stage. Reduce the coupling of continuous task functions.</p>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>An analogy of the image to the real-world plumbing. The data flows in the pipeline, and there are multiple valves on the pipeline. The valve can be regarded as a task node that processes the data. The valve operates on the data and returns the data in the same format for the next valve to use. In this way, pipes and valves can be regarded as classes that define task methods, and can be combined with each other in a linked list manner. Having multiple pieces of data flow through a pipeline presents concurrent computing.</p>
<blockquote>
<p>Pipeline pattern is an assembly line where partial results are passed from one stage to another.</p>
</blockquote>
<h2 id="Advantage"><a href="#Advantage" class="headerlink" title="Advantage"></a>Advantage</h2><ul>
<li>Reduce coupling. Similar task functions are abstracted into task base classes, and tasks only need to implement the main abstract method.</li>
<li>Simplify data objects. Data objects do not need to be deliberately adapted to task functions.</li>
<li>Task valves can be dynamically combined to add, delete or change the order.ask valves can be dynamically combined or changed in sequence.</li>
<li>Can improve bloated try-catch blocks when there are lots of exceptions in the code.</li>
<li>Compatible with concurrent computing</li>
</ul>
<h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h2><p>Operations on data can be divided into two categories. The first category does not change the data subject, but only changes part of the information, and some attribute information may not be modified. The other type is that the data subject will be changed, and the data will change greatly after the operation. The former can be regarded as a context, and the modification is the upper and lower internal information; while the latter requires the construction of input and output objects in pipeline mode, and the input and output objects may have large differences or cannot be modified. The latter transitional construction of objects may incur a large amount of space-time overhead in pipeline mode.</p>
<p>When using the pipeline mode, the developer needs to be clear about what input and output information is needed, so as to avoid the project being more chaotic because of the use of this mode.</p>
<h1 id="Implement"><a href="#Implement" class="headerlink" title="Implement"></a>Implement</h1><p>As mentioned in the <a href="">Attention</a>, two data formats are used here as examples.</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Context</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PipelineContext</span> &#123;</span><br><span class="line">    <span class="comment">// those data attributes that need to be processed</span></span><br><span class="line">    <span class="comment">// public int count;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PipeLine Result</span></span><br><span class="line"><span class="comment">// After a valve task completes, the information within the context is modified and </span></span><br><span class="line"><span class="comment">// a result object is returned which determines whether the next task valve was successfully entered. </span></span><br><span class="line"><span class="comment">// If unsuccessful, describe why.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PipeLineResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PipeLineResult</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PipeLineResult <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PipeLineResult</span>(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fail and reason</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PipeLineResult <span class="title function_">fail</span><span class="params">(String string)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PipeLineResult</span>(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pipeline valve task interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PipeLineTask</span> &#123;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    PipeLineTask <span class="title function_">getNext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(PipeLineTask PipLineTask)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the main function that needs to process the content</span></span><br><span class="line">    PipeLineResult <span class="title function_">invoke</span><span class="params">(PipeLineContext pipeLineContext)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Implement and enrich task</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PipeLineTaskImpl</span> <span class="keyword">implements</span> <span class="title class_">PipeLineTask</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">PipeLineTask</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PipeLineTask <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(PipeLineTask pipLineTask)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = pipLineTask;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PipeLineResult <span class="title function_">invoke</span><span class="params">(PipeLineContext pipeLineContext)</span> &#123;</span><br><span class="line">        before(pipeLineContext);</span><br><span class="line">        doFunc(pipeLineContext);</span><br><span class="line">        after(pipeLineContext);</span><br><span class="line">        <span class="keyword">return</span> processContinue(pipeLineContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PipeLineResult <span class="title function_">processContinue</span><span class="params">(PipeLineContext pipeLineContext)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// the last task finish</span></span><br><span class="line">            <span class="keyword">return</span> PipeLineResult.ok();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// do next task</span></span><br><span class="line">            <span class="keyword">return</span> getNext().invoke(pipeLineContext);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(PipeLineContext pipeLineContext)</span> &#123;</span><br><span class="line">        <span class="comment">// simple interceptor</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(PipeLineContext pipeLineContext)</span> &#123;</span><br><span class="line">        <span class="comment">// simple interceptor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// do core business logic</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doFunc</span><span class="params">(PipeLineContext pipeLineContext)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Implement task</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">PipeLineTaskImpl</span> &#123;</span><br><span class="line">    <span class="comment">// do core business logic</span></span><br><span class="line">    <span class="comment">// what to do</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doFunc</span><span class="params">(PipeLineContext pipeLineContext)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PipeLine</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PipeLine</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">PipeLineTask</span> <span class="variable">head</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">PipeLineTask</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PipeLine <span class="title function_">addTask</span><span class="params">(PipeLineTask task)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">            head = task;</span><br><span class="line">            tail = task;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tail.setNext(task);</span><br><span class="line">            tail = task;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PipeLineResult <span class="title function_">start</span><span class="params">(PipeLineContext pipeLineContext)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (pipeLineContext == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> PipeLineResult.fail(<span class="string">&quot;context is null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> PipeLineResult.fail(<span class="string">&quot;head is null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.invoke(pipeLineContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main</span></span><br><span class="line"><span class="comment">// Task extends PipeLineTaskImpl, overrides doFunc.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">PipeLine</span> <span class="variable">pipeLine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipeLine</span>();</span><br><span class="line">    pipeLine.addTask(<span class="keyword">new</span> <span class="title class_">Task1</span>).addTask(<span class="keyword">new</span> <span class="title class_">Task2</span>);</span><br><span class="line">    pipeLine.start(<span class="keyword">new</span> <span class="title class_">PipeLineContext</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Construct-input-and-output"><a href="#Construct-input-and-output" class="headerlink" title="Construct input and output"></a>Construct input and output</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Handler</span>&lt;I, O&gt; &#123;</span><br><span class="line">  O <span class="title function_">process</span><span class="params">(I input)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoveAlphabetsHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;String, String&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoveDigitsHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;String, String&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConvertToCharArrayHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;String, <span class="type">char</span>[]&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pipeline</span>&lt;I, O&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Handler&lt;I, O&gt; currentHandler;</span><br><span class="line"></span><br><span class="line">  Pipeline(Handler&lt;I, O&gt; currentHandler) &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentHandler = currentHandler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &lt;K&gt; Pipeline&lt;I, K&gt; <span class="title function_">addHandler</span><span class="params">(Handler&lt;O, K&gt; newHandler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pipeline</span>&lt;&gt;(input -&gt; newHandler.process(currentHandler.process(input)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  O <span class="title function_">execute</span><span class="params">(I input)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> currentHandler.process(input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">filters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pipeline</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">RemoveAlphabetsHandler</span>())</span><br><span class="line">    .addHandler(<span class="keyword">new</span> <span class="title class_">RemoveDigitsHandler</span>())</span><br><span class="line">    .addHandler(<span class="keyword">new</span> <span class="title class_">ConvertToCharArrayHandler</span>());</span><br><span class="line">filters.execute(<span class="string">&quot;GoYankees123!&quot;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="References-amp-Related"><a href="#References-amp-Related" class="headerlink" title="References &amp; Related"></a>References &amp; Related</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://java-design-patterns.com/patterns/pipeline/" title="java-design-patterns.com">java-design-patterns.com</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/design-pattern/chain-of-responsibility-pattern.html" title="runoob.com">runoob.com</a></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">V-LynX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline/">http://blog.valhalla.space/2022/03/21/DesignPattern/Pipeline/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.valhalla.space" target="_blank">Observatory</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><a class="post-meta__tags" href="/tags/%E8%A7%A3%E8%80%A6/">解耦</a><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/21/DesignPattern/Pipeline_CN/"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">[设计模式][中文]管道(管线)设计模式</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/02/BigData/Spark_CN/"><img class="next-cover" src="http://pic.valhalla.space/img/Blog/PicGo/Spark.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">[Spark][中文]Spark分析引擎介绍</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/21/DesignPattern/Pipeline_CN/" title="[设计模式][中文]管道(管线)设计模式"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-21</div><div class="title">[设计模式][中文]管道(管线)设计模式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="http://pic.valhalla.space/img/logo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">V-LynX</div><div class="author-info__description">Development Log</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Valhalla-LynX" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:infinitytree.com@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Abstract"><span class="toc-number">1.</span> <span class="toc-text">Abstract</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduce"><span class="toc-number">2.</span> <span class="toc-text">Introduce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Intent"><span class="toc-number">2.1.</span> <span class="toc-text">Intent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Explanation"><span class="toc-number">2.2.</span> <span class="toc-text">Explanation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Advantage"><span class="toc-number">2.3.</span> <span class="toc-text">Advantage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attention"><span class="toc-number">2.4.</span> <span class="toc-text">Attention</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Implement"><span class="toc-number">3.</span> <span class="toc-text">Implement</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context"><span class="toc-number">3.1.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Construct-input-and-output"><span class="toc-number">3.2.</span> <span class="toc-text">Construct input and output</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#References-amp-Related"><span class="toc-number">4.</span> <span class="toc-text">References &amp; Related</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/Logger/%5BPLG%5DLoki%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" title="[Log][PLG]Loki Microservices Log Collection"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Log][PLG]Loki Microservices Log Collection"/></a><div class="content"><a class="title" href="/2022/11/11/Logger/%5BPLG%5DLoki%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" title="[Log][PLG]Loki Microservices Log Collection">[Log][PLG]Loki Microservices Log Collection</a><time datetime="2022-11-11T01:34:13.000Z" title="发表于 2022-11-11 09:34:13">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/28/BigData/%5B%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%5D%5BFlink%5D%5BDataStream%20API%5D%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93/" title="[实时数仓][Flink][DataStream API]实时数仓"><img src="https://pic.valhalla.space/img/Blog/PicGo/Flink.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[实时数仓][Flink][DataStream API]实时数仓"/></a><div class="content"><a class="title" href="/2022/04/28/BigData/%5B%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%5D%5BFlink%5D%5BDataStream%20API%5D%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93/" title="[实时数仓][Flink][DataStream API]实时数仓">[实时数仓][Flink][DataStream API]实时数仓</a><time datetime="2022-04-28T07:45:30.000Z" title="发表于 2022-04-28 15:45:30">2022-04-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/21/DesignPattern/Pipeline_CN/" title="[设计模式][中文]管道(管线)设计模式"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[设计模式][中文]管道(管线)设计模式"/></a><div class="content"><a class="title" href="/2022/03/21/DesignPattern/Pipeline_CN/" title="[设计模式][中文]管道(管线)设计模式">[设计模式][中文]管道(管线)设计模式</a><time datetime="2022-03-21T10:21:20.000Z" title="发表于 2022-03-21 18:21:20">2022-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/21/DesignPattern/Pipeline/" title="[DesignPattern][Eng] Pipeline Design Pattern"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[DesignPattern][Eng] Pipeline Design Pattern"/></a><div class="content"><a class="title" href="/2022/03/21/DesignPattern/Pipeline/" title="[DesignPattern][Eng] Pipeline Design Pattern">[DesignPattern][Eng] Pipeline Design Pattern</a><time datetime="2022-03-21T03:52:25.000Z" title="发表于 2022-03-21 11:52:25">2022-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/02/BigData/Spark_CN/" title="[Spark][中文]Spark分析引擎介绍"><img src="http://pic.valhalla.space/img/Blog/PicGo/Spark.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Spark][中文]Spark分析引擎介绍"/></a><div class="content"><a class="title" href="/2022/03/02/BigData/Spark_CN/" title="[Spark][中文]Spark分析引擎介绍">[Spark][中文]Spark分析引擎介绍</a><time datetime="2022-03-02T06:50:20.000Z" title="发表于 2022-03-02 14:50:20">2022-03-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By V-LynX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>